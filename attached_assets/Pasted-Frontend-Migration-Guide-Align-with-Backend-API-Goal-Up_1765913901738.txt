Frontend Migration Guide - Align with Backend API
Goal: Update your existing Sakhi webapp to call the backend API endpoints instead of using localStorage and webhooks.

Priority Order
Auth (Highest Priority) - Registration & Login
Chat - Switch from webhook to backend
Onboarding - Use stateless backend wizard
Testing - Verify everything works
1. Update Registration Form
Current Issue
Registration form only saves to localStorage, doesn't call backend.

Required Changes
Add Missing Fields to Registration Form:

// In your registration form component
const [formData, setFormData] = useState({
  name: '',
  email: '',
  password: '',
  phoneNumber: '',        // ADD if missing
  gender: '',             // ADD if missing
  location: '',           // ADD if missing
  language: 'en',         // ADD if missing
});
// Add these form inputs:
<select
  value={formData.gender}
  onChange={(e) => setFormData({...formData, gender: e.target.value})}
  required
>
  <option value="">Select Gender</option>
  <option value="Male">Male</option>
  <option value="Female">Female</option>
  <option value="Other">Other</option>
</select>
<input
  type="text"
  placeholder="City/Town"
  value={formData.location}
  onChange={(e) => setFormData({...formData, location: e.target.value})}
  required
/>
<select
  value={formData.language}
  onChange={(e) => setFormData({...formData, language: e.target.value})}
>
  <option value="en">English</option>
  <option value="hi">Hindi</option>
  <option value="te">Telugu</option>
</select>
Replace localStorage with API Call:

// BEFORE (current implementation)
async function handleSignup(e) {
  e.preventDefault();
  localStorage.setItem('user', JSON.stringify(formData));
  router.push('/chat');
}
// AFTER (call backend API)
async function handleSignup(e) {
  e.preventDefault();
  
  try {
    const response = await fetch('http://localhost:8000/user/register', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        name: formData.name,
        email: formData.email,
        password: formData.password,
        phone_number: formData.phoneNumber || null,
        role: 'USER',
        preferred_language: formData.language,
        user_relation: null,
      }),
    });
    const data = await response.json();
    if (response.ok) {
      // Store user_id from backend
      localStorage.setItem('user_id', data.user_id);
      localStorage.setItem('user_name', data.user.name);
      router.push('/chat');
    } else {
      alert(data.detail || 'Registration failed');
    }
  } catch (error) {
    alert('Network error: ' + error.message);
  }
}
2. Update Login Form
Current Issue
Login only checks localStorage, doesn't authenticate with backend.

Required Changes
// BEFORE (current implementation)
async function handleLogin(e) {
  e.preventDefault();
  const storedUser = localStorage.getItem('user');
  if (storedUser) {
    router.push('/chat');
  }
}
// AFTER (call backend API)
async function handleLogin(e) {
  e.preventDefault();
  setError('');
  try {
    const response = await fetch('http://localhost:8000/user/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        email: email,
        password: password,
      }),
    });
    const data = await response.json();
    if (response.ok) {
      // Store user_id from backend
      localStorage.setItem('user_id', data.user_id);
      localStorage.setItem('user_name', data.user.name);
      router.push('/chat');
    } else {
      setError(data.detail || 'Invalid credentials');
    }
  } catch (error) {
    setError('Network error: ' + error.message);
  }
}
3. Update Chat Interface
Current Issue
Chat uses webhook: https://n8n.ottobon.in/webhook/sakhibot

Required Changes
Create API utility function:

// utils/api.js or services/api.js
const API_BASE_URL = 'http://localhost:8000';
export async function sendChatMessage(userId, message) {
  const response = await fetch(`${API_BASE_URL}/sakhi/chat`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      user_id: userId,
      message: message,
      language: 'en',
    }),
  });
  if (!response.ok) {
    throw new Error('Chat request failed');
  }
  return await response.json();
}
Update Chat Component:

// BEFORE (webhook)
async function handleSendMessage() {
  const response = await fetch('https://n8n.ottobon.in/webhook/sakhibot', {
    method: 'POST',
    body: JSON.stringify({ message: input }),
  });
  // ...
}
// AFTER (backend API)
import { sendChatMessage } from '@/utils/api';
async function handleSendMessage() {
  if (!input.trim()) return;
  const userId = localStorage.getItem('user_id');
  if (!userId) {
    alert('Please login first');
    return;
  }
  // Add user message to UI
  setMessages([...messages, { sender: 'user', text: input }]);
  setInput('');
  try {
    // Call backend
    const response = await sendChatMessage(userId, input);
    // Add Sakhi's reply
    setMessages((prev) => [
      ...prev,
      {
        sender: 'sakhi',
        text: response.reply,
        mode: response.mode,
        youtubeLink: response.youtube_link,
        infographic: response.infographic_url,
      },
    ]);
  } catch (error) {
    console.error('Chat error:', error);
    alert('Failed to send message');
  }
}
Display YouTube & Infographic:

function ChatMessage({ message }) {
  return (
    <div className={message.sender === 'user' ? 'user-msg' : 'sakhi-msg'}>
      <p>{message.text}</p>
      
      {/* Add these for Sakhi messages */}
      {message.youtubeLink && (
        <a href={message.youtubeLink} target="_blank" className="youtube-link">
          ðŸ“º Watch Video
        </a>
      )}
      
      {message.infographic && (
        <img src={message.infographic} alt="Infographic" className="infographic" />
      )}
    </div>
  );
}
4. Update Onboarding Wizard
Current Issue
Using client-side OnboardingQuestions.tsx only, not calling backend API.

Required Changes
Replace static questions with API calls:

// BEFORE (static questions)
import OnboardingQuestions from '@/data/OnboardingQuestions';
function OnboardingWizard() {
  const [currentStep, setCurrentStep] = useState(0);
  const question = OnboardingQuestions[currentStep];
  // ...
}
// AFTER (dynamic from backend)
function OnboardingWizard({ userId, relationshipType }) {
  const [parentProfileId] = useState(() => crypto.randomUUID());
  const [currentStep, setCurrentStep] = useState(1);
  const [answers, setAnswers] = useState({});
  const [question, setQuestion] = useState(null);
  const [totalSteps, setTotalSteps] = useState(0);
  const [isComplete, setIsComplete] = useState(false);
  // Load question from backend
  async function loadQuestion() {
    try {
      const response = await fetch('http://localhost:8000/onboarding/step', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          parent_profile_id: parentProfileId,
          relationship_type: relationshipType,
          current_step: currentStep,
          answers_json: answers,
        }),
      });
      const data = await response.json();
      if (data.completed) {
        // Save to database
        await saveProfile(data);
        setIsComplete(true);
      } else {
        setQuestion(data.question);
        setTotalSteps(data.total_steps);
      }
    } catch (error) {
      console.error('Failed to load question:', error);
    }
  }
  function handleAnswer(answer) {
    // Save answer
    const newAnswers = {
      ...answers,
      [question.field_name]: answer,
    };
    setAnswers(newAnswers);
    
    // Move to next step
    setCurrentStep(currentStep + 1);
  }
  useEffect(() => {
    loadQuestion();
  }, [currentStep]);
  if (isComplete) {
    return <div>Onboarding complete! Redirecting...</div>;
  }
  return (
    <div>
      <h2>Question {currentStep} of {totalSteps}</h2>
      {question && (
        <QuestionRenderer
          question={question}
          onAnswer={handleAnswer}
        />
      )}
    </div>
  );
}
Save completed profile:

async function saveProfile(completionData) {
  await fetch('http://localhost:8000/onboarding/complete', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      parent_profile_id: completionData.parent_profile_id,
      user_id: userId,
      relationship_type: completionData.relationship_type,
      answers_json: completionData.answers_json,
    }),
  });
}
5. Environment Configuration
Create .env.local file:

NEXT_PUBLIC_API_URL=http://localhost:8000
Use in code:

const API_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000';
// Use API_URL in all fetch calls
await fetch(`${API_URL}/user/register`, { ... });
6. Migration Checklist
Phase 1: Authentication âœ…
 Add gender field to registration form
 Add location field to registration form
 Add language dropdown to registration form
 Update registration handler to call POST /user/register
 Store 
user_id
 from backend response
 Update login handler to call POST /user/login
 Test registration & login flow
Phase 2: Chat âœ…
 Create sendChatMessage API utility
 Replace webhook URL with backend endpoint
 Update chat handler to use 
user_id
 from localStorage
 Add YouTube link display in chat messages
 Add infographic display in chat messages
 Test chat with logged-in user
Phase 3: Onboarding âœ…
 Update onboarding wizard to call POST /onboarding/step
 Replace static questions with dynamic backend questions
 Implement answer state management
 Call POST /onboarding/complete when done
 Test all relationship types (herself, mother, etc.)
Phase 4: Testing âœ…
 Test full user flow: Register â†’ Onboarding â†’ Chat
 Test login for returning users
 Verify data saves to backend database
 Check error handling for network issues
Quick Reference: API Endpoints
Feature	Endpoint	Method	Body
Register	/user/register	POST	name, email, password, gender, location
Login	/user/login	POST	email, password
Get Question	/onboarding/step	POST	parent_profile_id, relationship_type, current_step, answers_json
Save Profile	/onboarding/complete	POST	user_id, relationship_type, answers_json
Chat	/sakhi/chat	POST	user_id, message
Testing the Changes
After implementing, test in this order:

Register: Create a new account
Login: Login with the account
Onboarding: Complete parent profile wizard
Chat: Send messages and verify responses
Check backend server is running:

# Backend should be at http://localhost:8000
# Swagger docs at http://localhost:8000/docs
That's it! Follow the checklist and you'll have full backend integration. Let me know if you need clarification on any step.